<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyBrand</title>
    <link rel="stylesheet" href="../css/login.css" />
    <!-- for roboto font -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
      rel="stylesheet"
    />

    <!-- 
    bringing Icon for footer -->

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
  </head>
  <body>
    <header>
      <nav>
        <div class="menu">
          <h1 class="ngana_logo">Ngana</h1>
          <a href="../index.html" class="menu_nav">Home</a>
          <a href="./blog.html" class="menu_nav">Blog</a>
          <a href="./services.html" class="menu_nav">Services</a>
          <a href="./contact.html" class="menu_nav">Contact us</a>
          <a href="./login.html" class="menu_nav">login</a>
          <a href="./hire.html" class="menu_nav hire_now">Hire me</a>
          <!-- <button class="hire_now menu_nav">Hire me</button> -->
        </div>
      </nav>
    </header>
    <section>
      <div class="hero_section hero_login_section">
        <div class="hero_content hero_login_content">
          <h1>Subscribe to my blog, we have beautiful stories</h1>         
        </div>
      </div>

      <!-- Services section -->

      <div class="service_section">        
        <div class="service_content">
             <!-- for login -->
          <div class="service_item_left login_form" id="login_form">
             <div class="Service_form">
              <div class="service_form_item form_login" >
                <input type="text" name="email" class="email" placeholder="email" id="email_login"/>
                <input type="password" name="password" class="password" placeholder="password" id="password_login"/> 
                <div class="login_register">
                  <input class="login" type="submit" value="login" id="loginSubmit"/>
                  <input class="register" type="submit" value="register" />
                </div>      
              </div>
            </div>
          </div>
          
          <!-- for register -->
          <div class="service_item_left register_form hide" id="register_form">
            <div class="Service_form">
             <div class="service_form_item form_login">
               <input type="text" name="firstname" id="firstname" placeholder="firstname"/>
               <input type="text" name="lastname" id="lastname" placeholder="lastname"/>
               <input type="text" name="email" class="email" placeholder="email" id="email-register"/> 
               <input type="password" name="password" class="password" placeholder="password" id="password-register"/>
               <div class="login_register">
                <input class="register" type="submit" value="register" id="registerSubmit"/>
                 <input class="login" type="submit" value="login" />
                
               </div>      
             </div>
           </div>
         </div>

      </div>
    </section>

    <!-- footer info and details -->

    <footer>
      <div class="footer support">
        <h3>Phone support</h3>
        <p>24 hours a day</p>
        <p>+2507887573743</p>
      </div>
      <div class="footer social_media">
        <h3>Get intouch with us</h3>
        <i class="fa fa-facebook"></i>
        <i class="fa fa-instagram"></i>
        <i class="fa fa-twitter"></i>
      </div>
      <div class="footer subscribe">
        <h3>Subscribe to our blog</h3>
        <p>Singup for our offer</p>

        <div class="footer_input">
          <input type="text" name="email" id="email_subscribution" />
          <input class="footer_submit" type="submit" value="Subscribe" />
        </div>
      </div>
    </footer>
  </body>
  <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js" defer></script>
  <!-- <script src="../Js/firebase.js"></script>  -->
  <script src="../Js/login.js"></script>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js";
    import { getDatabase,set,ref,update } from "https://www.gstatic.com/firebasejs/9.6.7/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword  } from "https://www.gstatic.com/firebasejs/9.6.7/firebase-auth.js";
    // import { initializeApp } from "firebase/app";
    
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
       apiKey: "AIzaSyA5sPlupW_n1XEt6xsw_Y7aAZKltGEFyXw",
      authDomain: "mybrand-df7b7.firebaseapp.com",
      projectId: "mybrand-df7b7",
      storageBucket: "mybrand-df7b7.appspot.com",
      messagingSenderId: "1073877765217",
      appId: "1:1073877765217:web:7f63596f42c5d4ca18ae20",
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth();


    console.log(app)
    console.log(auth)
    //refernce a collection
    // const loginRef = database.ref("User");

//my login button

const registerSubmit = document.getElementById("registerSubmit");
const loginSubmit = document.getElementById("loginSubmit");

// // subtmit on clcik
// loginSubmit.addEventListener("click", (e) => {
//   e.preventDefault();

//   const name = getInputValue("name");
//   const email = getInputValue("email");
//   const password = getInputValue("password");

//   saveUser(name, email, password);
// });

//function to get inpu value

function getInputValue(id) {
  return document.getElementById(id).value;
}

// //save user to firebaseapp
// function saveUser(name, email, password) {
//   var newLoginRef = loginRef.push();

//   newLoginRef.set({
//     name: name,
//     email: email,
//     password: password,
//   });
// }

// register


registerSubmit.addEventListener("click", (e) => {
  e.preventDefault();

  const firstname = getInputValue("firstname");
  const lastname = getInputValue("lastname");
  const email = getInputValue("email-register");
  const password = getInputValue("password-register");

  createUserWithEmailAndPassword( auth, email.trim(), password.trim(), firstname.trim(),lastname.trim())
  .then((userCredential) => {
    // Signed in 
    const user = userCredential.user;
    set((ref(database,'users/'+user.uid), {
      firstname:firstname.trim(),
      lastname:lastname.trim(), 
      email:email.trim(),
    }))
    alert('User created')
    // ...
  })
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;
    alert(errorMessage)
    console.log(email.trim())
    // ..
  });

})

// login feature
loginSubmit.addEventListener("click", (e) => {
  e.preventDefault();
  const email = getInputValue("email_login");
  const password = getInputValue("password_login");

  signInWithEmailAndPassword(auth, email, password)
  .then((userCredential) => {
    // Signed in 
    const user = userCredential.user;
    alert('User logged successfully');
    window.location.href = "../html/dashboard.html";

    const dt = new Date();
    update((ref(database,'users/'+user.uid), {
      last_login:dt,
         }))
    // ...
  })
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;
    alert(errorMessage)
  });

})

  </script>
   
  
</html>
